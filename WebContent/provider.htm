<html>
<head>
<script src="scripts/jquery-1.7.1.min.js" type="text/javascript"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

<script src="scripts/jquery.easytabs.js" type="text/javascript"></script>

<link href="css/demo_page.css" type="text/css" rel="stylesheet">
<link href="css/demo_table.css" type="text/css" rel="stylesheet">
<script type="text/javascript" language="javascript" src="scripts/jquery.dataTables.js"></script>
<script type="text/javascript" src="scripts/dataTables.fnGetHiddenNodes.js"></script>

<link rel="stylesheet" href="css/jquery.treeview.css" />
<script src="scripts/jquery.treeview.js" type="text/javascript"></script>
<script src="scripts/jquery.treeview.async.js" type="text/javascript"></script>
	
<style>
	body { font: 80%/1.45em "Lucida Grande", Verdana, Arial, Helvetica, sans-serif; }
	/* Example Styles for Demo */
	.etabs { margin: 0; padding: 0; }
	.tab { display: inline-block; zoom:1; *display:inline; background: #eee; border: solid 1px #999; border-bottom: none; -moz-border-radius: 4px 4px 0 0; -webkit-border-radius: 4px 4px 0 0; }
	.tab a { font-size: 14px; line-height: 2em; display: block; padding: 0 10px; outline: none; }
	.tab a:hover { text-decoration: underline; }
	.tab.active { background: #fff; padding-top: 6px; position: relative; top: 1px; border-color: #666; }
	.tab a.active { font-weight: bold; }
	.tab-container .panel-container { background: #fff; border: solid #666 1px; padding: 10px; padding-bottom: 30px; -moz-border-radius: 0 4px 4px 4px; -webkit-border-radius: 0 4px 4px 4px; }
	.panel-container { margin-bottom: 10px; }
</style>
<script type="text/javascript">
$(document).ready( function() {
  $('#tab-container').easytabs();
  $("#investigator-specialty-tv").treeview({
  		url: "sources/investigator-specialty.json"
  });
  $("#investigator-specialty-network-graph-tv").treeview({
  		url: "sources/investigator-specialty.json"
  });
  $("#investigator-specialty-geo-graph-tv").treeview({
  		url: "sources/investigator-specialty.json"
  });
  $("#investigator-specialty-questions").treeview({
  		url: "sources/investigator-specialty.json"
  });
  
  if(!window.location.hash || window.location.hash == "#provider-list-tab") {
  	showProviderListLeftPanel();
  }
  else if(window.location.hash == "#network-graph-tab") {
  	showNetworkGraphLeftPanel();
  }
  else if(window.location.hash == "#geo-graph-tab") {
  	showGeoGraphLeftPanel();
  }
  else if(window.location.hash == "#questions-tab") {
	$("#leg-exp-prov-net").html('Question Builder');
  	showQuestionsLeftPanel();
  }
  
  $(".tab > a").click(function(event) {
       if($(this).attr("href") == "#provider-list-tab") {
	   		showProviderListLeftPanel();
			$("#leg-exp-prov-net").html('Explore Provider Network');
	   }
	   else if($(this).attr("href") == "#network-graph-tab") {
	   		showNetworkGraphLeftPanel();
			$("#leg-exp-prov-net").html('Explore Provider Network');
	   }
	   else if($(this).attr("href") == "#geo-graph-tab") {
	   		showGeoGraphLeftPanel();
			$("#leg-exp-prov-net").html('Explore Provider Network');
	   }
	   else if($(this).attr("href") == "#questions-tab") {
	   		$("#leg-exp-prov-net").html('Question Builder');
	   		showQuestionsLeftPanel();
	   }
  });
	var providerListTable = $('#provider-list').dataTable( {
		"bServerSide": true,
		"bProcessing": true,
		"bRetrieve": true,
		"sAjaxSource": "providerdata",
		"sAjaxDataProp": "providerList"
	});
	
	var questionsProviderListTable = $('#questions-provider-list').dataTable( {
		"bProcessing": true,
		"sAjaxSource": "sources/provider-list.json",
		"sAjaxDataProp": "providerList"
	});

});

jQuery.fn.dataTableExt.aTypes.push(
    function ( sData ) {
        return 'html';
    }
);

function showProviderListLeftPanel() {
	$("#lft-div-provider-list").show();
	$("#lft-div-network-graph").hide();
	$("#lft-div-geo-graph").hide();
	$("#lft-div-questions").hide();
	$("#divFindProvider").show();
}

function showNetworkGraphLeftPanel() {
	$("#lft-div-provider-list").hide();
	$("#lft-div-network-graph").show();
	$("#lft-div-map-view").hide();
	$("#lft-div-questions").hide();
	$("#divFindProvider").show();
}
function showGeoGraphLeftPanel() {
	$("#lft-div-provider-list").hide();
	$("#lft-div-network-graph").hide();
	$("#lft-div-geo-graph").show();
	$("#lft-div-investigator-list").hide();
	$("#divFindProvider").show();
	//initializeMap();
	setTimeout(function() {
		var center = map.getCenter();
		google.maps.event.trigger(map, "resize");
		map.setCenter(center);
	}, 1000);
	
}

function showQuestionsLeftPanel() {
	$("#lft-div-provider-list").hide();
	$("#lft-div-network-graph").hide();
	$("#lft-div-geo-graph").hide();
	$("#lft-div-questions").show();
	$("#divFindProvider").show();
}

function loadIframe(iframeName, url) {
    var $iframe = $('#' + iframeName);
    if(url=='')
    {
    	url = 'provider_graph.html?pid=' + $('#pid_network_graph').val();
    }
    else
    {
    	url = 'provider_graph.html?pid=' + url;
    }
    if ( $iframe.length ) {
        $iframe.attr('src',url);   
        return false;
    }
    return true;
}

function loadGridFromProviderId() {
    var url = 'providerdata?pid=' + $('#pid_provider_list').val();
    url += '&state=' + $('#state_provider_list').val();
    var table = $('#provider-list').dataTable();
    //table.fnDraw(true);
    table.fnReloadAjax(url);
    //table.fnClearTable();
}



//google.maps.visualRefresh = true;
var map;
function initializeMap() {
  var mapOptions = {
	zoom: 14,
	center: new google.maps.LatLng(40.3140,-74.5089),
	mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
	  mapOptions);
}

google.maps.event.addDomListener(window, 'load', initializeMap);
</script>
</head>

<body>
<div style="clear:both;">
	<h1>Provider Network Analysis</h1>
</div>
<div id="divFindProvider" style="display:none;">
	<input type="text" placeholder="find provider" style="float:right">
</div>
<div style="display:inline-block; width:25%; float:left;">
	<fieldset>
		<legend id="leg-exp-prov-net">Explore Provider Network</legend>
		<div id="lft-div-provider-list" style="display:none;">
			<strong>Enter Provider Id</strong>
			<br />
			<input id="pid_provider_list" name="pid_provider_list" type="text" onchange="javascript:$('#state_provider_list').val(0);">
			<br /><br />
			<select id="state_provider_list" name="state_provider_list" onchange="javascript:$('#pid_provider_list').val('');">
				<option>All States</option>
				<option>AZ</option>
				<option>AL</option>
				<option>NJ</option>
			</select>
			<br /><br />
			<strong>Enter City (Optional)</strong>
			<br />
			<input type="text">
			<br /><br />
			<hr width="200" style="float:left;" />
			<br />
			<strong>Select Investigator Speciality</strong>
			<ul id="investigator-specialty-tv" class="filetree"></ul>
			
			
			<br /><br /><br /><br />
			<div style="vertical-align:bottom">
			<input type="button" value="Filter Results" onclick="javascript:loadGridFromProviderId()"></div>
		</div>
		
		<div id="lft-div-network-graph" style="display:none">
			<strong>Enter Provider Id</strong>
			<br />
			<input id="pid_network_graph" name="pid_network_graph" type="text">
			<br /><br />
			<strong>View only top k referrals</strong>
			<br />
			<select>
				<option>10</option>
				<option>50</option>
				<option>100</option>
			</select>
			<br /><br />
			<hr width="200" style="float:left;" />
			<br />
			<strong>Select Direction of Referral</strong>
			<br />
			<input type="checkbox" checked="checked"> Referred other providers
			<br />
			<input type="checkbox"> Was referred by other provider
			<br />
			<input type="checkbox"> Referrals happened in both
			<br /><br />
			<hr width="200" style="float:left;" />
			<br />
			<strong>Select Investigator Speciality</strong>
			<ul id="investigator-specialty-network-graph-tv" class="filetree"></ul>
			<br /><br /><br /><br />
			<input type="button" value="Run Analysis" onclick="javascript:loadIframe('graphFrame', '')" />
		</div>
		
		<div id="lft-div-geo-graph" style="display:none;">
			<strong>Enter Provider Id</strong>
			<br />
			<input type="text">
			<br /><br />
			<hr width="200" style="float:left;" />
			<br />
			<strong>Limit to k mile radius</strong>
			<br />
			<select>
				<option>10</option>
				<option>50</option>
				<option>100</option>
			</select>
			<br /><br />
			<strong>Select Direction of Referral</strong>
			<br />
			<input type="checkbox" checked="checked"> Referred other providers
			<br />
			<input type="checkbox"> Was referred by other provider
			<br />
			<input type="checkbox"> Referrals happened in both
			<br /><br />
			<hr width="200" style="float:left;" />
			<br />
			<strong>Select Investigator Speciality</strong>
			<ul id="investigator-specialty-geo-graph-tv" class="filetree"></ul>
			<br /><br /><br /><br />
			<input type="button" value="Run Analysis">
		</div>
		
		<div id="lft-div-questions" style="display:none;">
			<strong>Report Generator</strong>
		</div>
	</fieldset>
</div>
<div style="display:inline-block; float:left; width:75%">
	<div id="tab-container" class='tab-container'>
		<ul class='etabs'>
		   <li class='tab'><a href="#provider-list-tab">Provider List</a></li>
		   <li class='tab'><a href="#network-graph-tab">Network Graph</a></li>
		   <li class='tab'><a href="#geo-graph-tab">Geo Graph</a></li>
		   <li class='tab'><a href="#questions-tab">Questions</a></li>
		</ul>
		<div class='panel-container'>
			<div id="provider-list-tab">
				<table cellpadding="0" cellspacing="0" border="0" class="display grid-list" id="provider-list">
					<thead>
						<tr>
							<th width="20%">PMID (Provider Identifier)</th>
							<th width="25%">Business Name</th>
							<th width="25%">Name</th>
							<th width="15%">Specialty</th>
							<th width="15%">Graph</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
			<div id="network-graph-tab">
				<iframe name="graphFrame" id="graphFrame" width="1280" height="1024" src=""></iframe>
			</div>
			<div id="geo-graph-tab">
				<div id="map-canvas" style="width:100%; height:75%;"></div>
			</div>
			<div id="questions-tab">
				<strong>I want to know which doctor might be the best in my city based on peer communications.</strong>
				<br /><br>
				<strong>so show me the top</strong> <select><option>10</option><option>50</option><option>100</option></select> <strong>providers
				who have received the most referrals in city</strong> <input type="text">&nbsp;<select><option>State</option><option>NJ</option></select>
				<br /><br>
				<strong><div style="float:left;">for specialty: </div><div style="float:left;"><ul id="investigator-specialty-questions" class="filetree"></ul></div>
				<br /><br /><br /><br />
				<div style="clear:both;">
					<input type="button" value="Run Analysis">
				</div>
				<br /><br /><br /><br />
				<table cellpadding="0" cellspacing="0" border="0" class="display grid-list" id="questions-provider-list">
					<thead>
						<tr>
							<th width="20%">PMID (Provider Identifier)</th>
							<th width="25%">Business Name</th>
							<th width="25%">Name</th>
							<th width="15%">Specialty</th>
							<th width="15%">Graph</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
</body>
</html>